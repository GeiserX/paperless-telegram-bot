# paperless-telegram-bot - AI Assistant Configuration

> **Project Context:** This is an open-source project. Consider community guidelines and contribution standards.

## Persona

You assist developers working on paperless-telegram-bot.

Project description: Telegram bot for managing Paperless-NGX documents. Upload files and photos, full-text search with pagination, metadata management (tags, correspondents, document types), download documents, and view statistics. Docker-ready.

## Tech Stack

- Python 3.11+
- python-telegram-bot (Telegram Bot API)
- httpx (async HTTP client for Paperless-NGX API)
- FastAPI + uvicorn (health check endpoint)
- Docker

## Repository & Infrastructure

- **Host:** GitHub
- **License:** GPL-3.0
- **Architecture:** Single Docker container running Telegram bot + health endpoint
- **Commits:** Follow [Conventional Commits](https://conventionalcommits.org) format
- **Versioning:** Follow [Semantic Versioning](https://semver.org) (semver)
- **CI/CD:** GitHub Actions
- **Deployment:** Docker via Portainer GitOps
- **Docker Image:** `drumsergio/paperless-telegram-bot`

## Git Workflow

- **Workflow:** Create feature branches and submit pull requests
- Do NOT commit directly to main branch
- Create descriptive branch names (e.g., `feat/batch-upload`, `fix/search-pagination`)

## Deployment Workflow

### Versioning Rules

- **NEVER** reuse or force-retag an existing version. Tags only go forward.
- **Patch** (`v0.2.0` -> `v0.2.1`): Bug fixes, small tweaks
- **Minor** (`v0.2.x` -> `v0.3.0`): New features, significant behavior changes
- **Major** (`v0.x.y` -> `v1.0.0`): Breaking changes
- Check the latest tag before tagging: `git describe --tags --abbrev=0`
- Also update the image tag in `gitea/geiserback/paperless-telegram-bot/docker-compose.yml` to match

### Release Steps

1. Create feature branch, push, open PR, merge to `main`
2. Create a **new** semver tag (e.g. `git tag -a v0.3.0 -m "v0.3.0"`) and push with `--tags`
3. **Wait for GHA `docker-publish.yml` to complete** — verify the run succeeds before proceeding
4. Update `gitea/geiserback/paperless-telegram-bot/docker-compose.yml` with the new tag, commit and push to Gitea
5. Redeploy via Portainer API on **geiserback** (stack ID `80`, endpoint `2`)
6. Verify with `docker ps --filter name=paperless_telegram_bot` and check logs for `Bot commands registered`

## Important Files to Read

- `src/paperless_bot/bot/handlers.py` — Telegram bot logic, command handlers, callback routing
- `src/paperless_bot/api/client.py` — Paperless-NGX API client
- `src/paperless_bot/bot/keyboards.py` — Inline keyboard builders
- `src/paperless_bot/config.py` — Environment variables and configuration
- `src/paperless_bot/__main__.py` — Entry point, health server, CLI

## Boundaries

### Always (do without asking)

- Create new files
- Change dependencies
- Modify Docker config
- Update docs and README
- Change environment vars

### Ask First

- Delete files
- Change Paperless-NGX API contracts
- Modify callback_data encoding scheme

### Never

- Modify .env files or secrets
- Force push to git
- Reuse existing version tags
- Expose tokens or credentials in logs

## Code Style

- **Naming:** Follow idiomatic Python conventions
- **Logging:** `logger = logging.getLogger(__name__)`
- **Linter/Formatter:** `ruff check src/` and `ruff format src/`
- Follow PEP 8, use type hints, prefer f-strings
- Use `_safe_edit()` wrapper for all Telegram message edits
- Keep functions focused and testable

## Key Architecture Decisions

- **Bot commands** are registered via `set_my_commands` in `post_init` callback
- **callback_data** has a 64-byte limit — search queries stored in per-chat dict, pagination uses short prefixes (`sp:`, `tagp:`, `corrp:`, `dtypep:`)
- **Metadata caching:** Tags, correspondents, document types are cached in `PaperlessClient` to reduce API calls
- **Media groups:** Batch upload with 1.5s collection delay before processing
- **Health check:** FastAPI on port 8080 for container health monitoring

## Testing

- **Framework:** pytest, pytest-asyncio, respx (HTTP mocking)
- **Coverage Target:** 80%

## Security Notice

> **Do not commit secrets to the repository or to the live app.**
> Use environment variables for all credentials.

---

*Generated by [LynxPrompt](https://lynxprompt.com) CLI*
